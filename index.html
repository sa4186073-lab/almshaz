<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Wizard AI - المشعوذ الرقمي</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                    },
                    colors: {
                        slate: { 850: '#151b2e', 900: '#0f172a' },
                        amber: { 450: '#F59E0B' } 
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #020617; overflow: hidden; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .gradient-text {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(to right, #fbbf24, #d97706);
        }
    </style>
</head>
<body class="text-white h-screen w-full selection:bg-amber-500/30">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- ICON HELPER ---
        const createIcon = (name) => ({ size = 24, className = "", ...props }) => {
            const iconRef = useRef(null);
            const propsString = JSON.stringify(props);

            useEffect(() => {
                if (iconRef.current && window.lucide && window.lucide.icons && window.lucide.icons[name]) {
                    const iconNode = window.lucide.icons[name];
                    if (window.lucide.createElement) {
                        const svgElement = window.lucide.createElement(iconNode);
                        svgElement.setAttribute('width', size);
                        svgElement.setAttribute('height', size);
                        if (className) svgElement.setAttribute('class', (svgElement.getAttribute('class') || '') + ' ' + className);
                        
                        const currentProps = JSON.parse(propsString);
                        Object.keys(currentProps).forEach(key => {
                             if (currentProps[key] !== undefined) svgElement.setAttribute(key, currentProps[key]);
                        });

                        iconRef.current.innerHTML = '';
                        iconRef.current.appendChild(svgElement);
                    }
                }
            }, [name, size, className, propsString]);

            return <span ref={iconRef} style={{ display: 'inline-flex', alignItems: 'center' }} />;
        };

        // Icons
        const Icons = {
            Wand2: createIcon("Wand2"),
            Instagram: createIcon("Instagram"),
            Twitter: createIcon("Twitter"),
            Linkedin: createIcon("Linkedin"),
            Facebook: createIcon("Facebook"),
            Youtube: createIcon("Youtube"),
            Music: createIcon("Music"),
            Copy: createIcon("Copy"),
            Check: createIcon("Check"),
            Sparkles: createIcon("Sparkles"),
            Loader2: createIcon("Loader2"),
            Zap: createIcon("Zap"),
            Star: createIcon("Star"),
            Flame: createIcon("Flame"),
            Feather: createIcon("Feather"),
            Volume2: createIcon("Volume2"),
            VolumeX: createIcon("VolumeX"),
            X: createIcon("X"),
            History: createIcon("History"),
            MessageCircle: createIcon("MessageCircle"),
            LayoutTemplate: createIcon("LayoutTemplate"),
            FileText: createIcon("FileText"),
            Film: createIcon("Film"),
            Layers: createIcon("Layers"),
            Image: createIcon("Image"),
            Heart: createIcon("Heart"),
            Plus: createIcon("Plus"),
            Eye: createIcon("Eye"),
            Type: createIcon("Type"),
            Share: createIcon("Share"),
            Book: createIcon("Book"),
            Key: createIcon("Key"),
            Trash2: createIcon("Trash2"),
            Maximize2: createIcon("Maximize2"),
            Bot: createIcon("Bot"),
        };

        // --- PLATFORM CONFIG ---
        const platforms = [
            { id: 'instagram', name: 'انستغرام', icon: Icons.Instagram, color: 'text-fuchsia-400', border: 'hover:border-fuchsia-500', bg: 'hover:bg-fuchsia-950/30' },
            { id: 'tiktok', name: 'تيك توك', icon: Icons.Music, color: 'text-pink-400', border: 'hover:border-pink-500', bg: 'hover:bg-pink-950/30' },
            { id: 'twitter', name: 'تويتر (X)', icon: Icons.Twitter, color: 'text-cyan-400', border: 'hover:border-cyan-500', bg: 'hover:bg-cyan-950/30' },
            { id: 'youtube', name: 'يوتيوب', icon: Icons.Youtube, color: 'text-red-400', border: 'hover:border-red-500', bg: 'hover:bg-red-950/30' },
            { id: 'linkedin', name: 'لينكد إن', icon: Icons.Linkedin, color: 'text-blue-400', border: 'hover:border-blue-500', bg: 'hover:bg-blue-950/30' },
            { id: 'facebook', name: 'فيسبوك', icon: Icons.Facebook, color: 'text-indigo-400', border: 'hover:border-indigo-500', bg: 'hover:bg-indigo-950/30' },
            { id: 'whatsapp', name: 'واتساب', icon: Icons.MessageCircle, color: 'text-green-400', border: 'hover:border-green-500', bg: 'hover:bg-green-950/30' },
        ];

        const contentTypes = [
            { id: 'post', name: 'منشور', icon: Icons.FileText },
            { id: 'tweet', name: 'تغريدة', icon: Icons.Twitter },
            { id: 'thread', name: 'سلسلة', icon: Icons.LayoutTemplate },
            { id: 'story', name: 'قصة', icon: Icons.Layers },
            { id: 'reel', name: 'سيناريو ريلز', icon: Icons.Film },
            { id: 'caption', name: 'كابشن صورة', icon: Icons.Image },
        ];

        const tones = [
            { id: 'professional', name: 'رسمي' },
            { id: 'funny', name: 'فكاهي' },
            { id: 'engaging', name: 'تفاعلي' },
            { id: 'inspirational', name: 'ملهم' },
            { id: 'educational', name: 'تعليمي' },
            { id: 'urgent', name: 'عاجل' },
        ];

        // --- COMPONENTS ---
        
        const PlatformPreview = ({ content, platformId }) => {
            const isTwitter = platformId === 'twitter';
            const isFacebook = platformId === 'facebook';
            
            return (
                <div className="w-full bg-white text-black rounded-lg overflow-hidden shadow-2xl text-left border border-gray-200" dir="rtl">
                    <div className={`p-3 flex items-center gap-3 border-b border-gray-100 ${isFacebook ? 'bg-[#1877F2] text-white' : 'bg-white'}`}>
                        <div className={`w-8 h-8 rounded-full ${isFacebook ? 'bg-white/20' : 'bg-gray-200'} flex items-center justify-center shrink-0`}>
                            <Icons.Bot size={16} className={isFacebook ? "text-white" : "text-gray-500"} />
                        </div>
                        <div>
                            <p className={`text-xs font-bold ${isFacebook ? 'text-white' : 'text-gray-900'}`}>المشعوذ الرقمي</p>
                            <p className={`text-[10px] ${isFacebook ? 'text-white/80' : 'text-gray-500'}`}>الآن · <Icons.Bot size={10} className="inline" /></p>
                        </div>
                    </div>
                    <div className={`p-4 ${isTwitter ? 'text-lg' : 'text-sm'} text-gray-800 whitespace-pre-line leading-relaxed`}>
                        {content || "المحتوى سيظهر هنا..."}
                    </div>
                    {!isTwitter && (
                        <div className="w-full h-48 bg-gray-100 flex flex-col items-center justify-center text-gray-400 gap-2">
                            <Icons.Image size={32} />
                            <span className="text-xs">مساحة الوسائط (صورة/فيديو)</span>
                        </div>
                    )}
                    <div className="p-3 border-t border-gray-100 flex items-center justify-between text-gray-500">
                        <div className="flex gap-4">
                            <Icons.Heart size={20} />
                            <Icons.MessageCircle size={20} />
                            <Icons.Share size={20} />
                        </div>
                    </div>
                </div>
            );
        };

        const SocialWizardWeb = () => {
            // State
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('gemini_api_key') || "");
            const [showSettings, setShowSettings] = useState(!localStorage.getItem('gemini_api_key'));
            
            // Inputs
            const [platform, setPlatform] = useState('instagram');
            const [contentType, setContentType] = useState('post');
            const [tone, setTone] = useState('engaging');
            const [customTone, setCustomTone] = useState('');
            const [topic, setTopic] = useState('');
            
            // Outputs
            const [generatedContent, setGeneratedContent] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [viewMode, setViewMode] = useState('text'); // text | preview
            
            // Data
            const [history, setHistory] = useState([]);
            const [favorites, setFavorites] = useState([]);
            const [activeSidebarTab, setActiveSidebarTab] = useState('history');

            // Audio
            const [isMuted, setIsMuted] = useState(false);
            const audioCtxRef = useRef(null);

            // Init Data
            useEffect(() => {
                const savedFavs = localStorage.getItem('socialWizardFavs');
                if (savedFavs) setFavorites(JSON.parse(savedFavs));
                
                const savedHist = localStorage.getItem('socialWizardHist');
                if (savedHist) setHistory(JSON.parse(savedHist));
            }, []);

            // Save Data
            useEffect(() => { localStorage.setItem('socialWizardFavs', JSON.stringify(favorites)); }, [favorites]);
            useEffect(() => { localStorage.setItem('socialWizardHist', JSON.stringify(history)); }, [history]);

            // Audio System
            const playSound = (type) => {
                if (isMuted) return;
                if (!audioCtxRef.current) audioCtxRef.current = new (window.AudioContext || window.webkitAudioContext)();
                if (audioCtxRef.current.state === 'suspended') audioCtxRef.current.resume();
                
                const ctx = audioCtxRef.current;
                const now = ctx.currentTime;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);

                if (type === 'click') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800, now);
                    osc.frequency.exponentialRampToValueAtTime(400, now + 0.1);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                    osc.start(now); osc.stop(now + 0.1);
                } else if (type === 'magic') {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(300, now);
                    osc.frequency.linearRampToValueAtTime(600, now + 0.5);
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(0.1, now + 0.1);
                    gain.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc.start(now); osc.stop(now + 0.5);
                } else if (type === 'success') {
                    [523.25, 659.25, 783.99].forEach((freq, i) => {
                        const o = ctx.createOscillator();
                        const g = ctx.createGain();
                        o.connect(g); g.connect(ctx.destination);
                        o.type = 'sine'; o.frequency.value = freq;
                        g.gain.setValueAtTime(0.03, now + i*0.1);
                        g.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.3);
                        o.start(now + i*0.1); o.stop(now + i*0.1 + 0.3);
                    });
                }
            };

            const handleGenerate = async () => {
                if (!apiKey) { setShowSettings(true); return; }
                if (!topic.trim()) { setError('ما هو الموضوع؟'); playSound('click'); return; }

                playSound('magic');
                setIsLoading(true);
                setError('');
                
                try {
                    const selectedTone = customTone || tones.find(t => t.id === tone)?.name;
                    const platformName = platforms.find(p => p.id === platform)?.name;
                    const contentTypeName = contentTypes.find(c => c.id === contentType)?.name;

                    const systemPrompt = `أنت خبير وسائل تواصل اجتماعي. اكتب محتوى ${contentTypeName} لمنصة ${platformName} باللهجة أو اللغة المناسبة.`;
                    const userPrompt = `النبرة: ${selectedTone}\nالموضوع: ${topic}\n\nاكتب محتوى إبداعي وجذاب مع هاشتاجات.`;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userPrompt }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        }),
                    });

                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error?.message || 'Error');
                    
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) {
                        setGeneratedContent(text);
                        const newItem = { id: Date.now(), platform, contentType, topic, fullText: text, date: new Date().toISOString() };
                        setHistory(prev => [newItem, ...prev].slice(0, 50));
                        playSound('success');
                    }
                } catch (err) {
                    setError('حدث خطأ. تأكد من المفتاح أو الاتصال.');
                } finally {
                    setIsLoading(false);
                }
            };

            const toggleFavorite = (item) => {
                const exists = favorites.find(f => f.id === item.id);
                if (exists) {
                    setFavorites(prev => prev.filter(f => f.id !== item.id));
                } else {
                    setFavorites(prev => [item, ...prev]);
                    playSound('success');
                }
            };

            const restoreItem = (item) => {
                setTopic(item.topic);
                setPlatform(item.platform);
                if (item.contentType) setContentType(item.contentType);
                setGeneratedContent(item.fullText);
                playSound('click');
            };

            const deleteItem = (e, id, listType) => {
                e.stopPropagation();
                if(listType === 'history') setHistory(h => h.filter(i => i.id !== id));
                else setFavorites(f => f.filter(i => i.id !== id));
            }

            // --- RENDER ---
            return (
                <div className="flex flex-col h-screen w-full bg-[#020617] text-slate-200 overflow-hidden">
                    
                    {/* Background Ambience */}
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-amber-500/5 rounded-full blur-[120px]"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-indigo-500/5 rounded-full blur-[120px]"></div>
                    </div>

                    {/* Navbar */}
                    <header className="shrink-0 h-16 border-b border-white/5 bg-black/40 backdrop-blur-md flex items-center justify-between px-6 z-20">
                        <div className="flex items-center gap-3">
                            <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-orange-600 flex items-center justify-center shadow-lg shadow-amber-900/20">
                                <Icons.Wand2 size={18} className="text-black" />
                            </div>
                            <h1 className="text-xl font-bold tracking-tight">
                                <span className="text-white">Social</span>
                                <span className="gradient-text">Wizard</span>
                            </h1>
                        </div>
                        <div className="flex items-center gap-3">
                             <button 
                                onClick={() => setIsMuted(!isMuted)}
                                className={`p-2 rounded-lg transition-colors ${isMuted ? 'text-slate-600' : 'text-amber-400 bg-amber-400/10'}`}
                            >
                                {isMuted ? <Icons.VolumeX size={18} /> : <Icons.Volume2 size={18} />}
                            </button>
                            <button 
                                onClick={() => setShowSettings(true)} 
                                className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all border ${!apiKey ? 'bg-red-500/10 border-red-500 text-red-400 animate-pulse' : 'bg-white/5 border-white/10 text-slate-400 hover:text-white'}`}
                            >
                                <Icons.Key size={14} />
                                <span>{apiKey ? 'المفتاح محفوظ' : 'إعداد المفتاح'}</span>
                            </button>
                        </div>
                    </header>

                    {/* Main Grid */}
                    <main className="flex-1 flex overflow-hidden relative z-10">
                        
                        {/* LEFT SIDEBAR: History & Favorites */}
                        <aside className="hidden lg:flex flex-col w-80 border-l border-white/5 bg-[#050b1d]/50 backdrop-blur-sm">
                            <div className="p-4 border-b border-white/5 flex gap-2">
                                <button 
                                    onClick={() => setActiveSidebarTab('history')}
                                    className={`flex-1 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all ${activeSidebarTab === 'history' ? 'bg-white/10 text-white' : 'text-slate-500 hover:text-slate-300'}`}
                                >
                                    <Icons.History size={14} /> السجل
                                </button>
                                <button 
                                    onClick={() => setActiveSidebarTab('favorites')}
                                    className={`flex-1 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all ${activeSidebarTab === 'favorites' ? 'bg-amber-500/10 text-amber-400' : 'text-slate-500 hover:text-slate-300'}`}
                                >
                                    <Icons.Star size={14} /> المحفوظات
                                </button>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto p-3 space-y-3">
                                {(activeSidebarTab === 'history' ? history : favorites).length === 0 && (
                                    <div className="text-center py-10 text-slate-600 text-sm">
                                        لا يوجد عناصر هنا بعد
                                    </div>
                                )}
                                {(activeSidebarTab === 'history' ? history : favorites).map(item => (
                                    <div 
                                        key={item.id}
                                        onClick={() => restoreItem(item)}
                                        className="group p-3 rounded-xl bg-white/5 border border-white/5 hover:border-white/10 hover:bg-white/10 transition-all cursor-pointer relative"
                                    >
                                        <div className="flex justify-between items-start mb-2">
                                            <div className="flex items-center gap-2">
                                                {platforms.find(p => p.id === item.platform)?.icon({ size: 14, className: 'text-slate-400' })}
                                                <span className="text-[10px] font-bold text-slate-500 uppercase">{item.platform}</span>
                                            </div>
                                            <button 
                                                onClick={(e) => deleteItem(e, item.id, activeSidebarTab)}
                                                className="text-slate-700 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity"
                                            >
                                                <Icons.Trash2 size={14} />
                                            </button>
                                        </div>
                                        <p className="text-xs text-slate-300 line-clamp-2 leading-relaxed">{item.fullText}</p>
                                    </div>
                                ))}
                            </div>
                        </aside>

                        {/* CENTER: The Lab (Inputs) */}
                        <section className="flex-1 overflow-y-auto p-4 lg:p-8 custom-scroll">
                            <div className="max-w-2xl mx-auto space-y-8">
                                
                                {/* Platform Select */}
                                <div>
                                    <label className="flex items-center gap-2 text-sm font-bold text-slate-400 mb-4">
                                        <Icons.Flame size={16} className="text-amber-500" />
                                        اختر المنصة
                                    </label>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                        {platforms.map(p => (
                                            <button
                                                key={p.id}
                                                onClick={() => { setPlatform(p.id); playSound('click'); }}
                                                className={`relative group p-3 rounded-xl border transition-all duration-300 flex flex-col items-center gap-2 ${platform === p.id ? `bg-white/10 border-white text-white shadow-[0_0_20px_rgba(255,255,255,0.1)]` : `bg-[#0f172a] border-white/5 text-slate-500 ${p.bg} ${p.border}`}`}
                                            >
                                                <p.icon size={24} className={platform === p.id ? 'text-white' : p.color} />
                                                <span className="text-xs font-bold">{p.name}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Type & Tone Row */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div>
                                        <label className="flex items-center gap-2 text-sm font-bold text-slate-400 mb-4">
                                            <Icons.LayoutTemplate size={16} className="text-amber-500" />
                                            نوع المحتوى
                                        </label>
                                        <div className="grid grid-cols-2 gap-2">
                                            {contentTypes.map(c => (
                                                <button
                                                    key={c.id}
                                                    onClick={() => { setContentType(c.id); playSound('click'); }}
                                                    className={`flex items-center gap-2 px-3 py-2.5 rounded-lg text-xs font-bold transition-all border ${contentType === c.id ? 'bg-amber-500 text-black border-amber-500' : 'bg-white/5 text-slate-400 border-white/5 hover:bg-white/10'}`}
                                                >
                                                    <c.icon size={14} /> {c.name}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2 text-sm font-bold text-slate-400 mb-4">
                                            <Icons.Zap size={16} className="text-amber-500" />
                                            نبرة الصوت
                                        </label>
                                        <div className="flex flex-wrap gap-2">
                                            {tones.map(t => (
                                                <button
                                                    key={t.id}
                                                    onClick={() => { setTone(t.id); setCustomTone(''); playSound('click'); }}
                                                    className={`px-3 py-1.5 rounded-full text-xs font-bold transition-all border ${tone === t.id && !customTone ? 'bg-indigo-500 text-white border-indigo-500' : 'bg-white/5 text-slate-400 border-white/5 hover:bg-white/10'}`}
                                                >
                                                    {t.name}
                                                </button>
                                            ))}
                                            <input 
                                                type="text"
                                                placeholder="مخصص..."
                                                value={customTone}
                                                onChange={(e) => { setCustomTone(e.target.value); setTone(''); }}
                                                className={`w-full mt-2 px-3 py-2 rounded-lg bg-black border text-xs text-white focus:outline-none focus:border-indigo-500 ${customTone ? 'border-indigo-500' : 'border-white/10'}`}
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Topic Input */}
                                <div>
                                    <label className="flex items-center gap-2 text-sm font-bold text-slate-400 mb-4">
                                        <Icons.Feather size={16} className="text-amber-500" />
                                        الموضوع / الفكرة
                                    </label>
                                    <div className="relative">
                                        <textarea
                                            value={topic}
                                            onChange={(e) => setTopic(e.target.value)}
                                            placeholder="عن ماذا تريد أن تتحدث اليوم؟"
                                            className="w-full h-32 p-4 rounded-xl bg-white/5 border border-white/10 text-white placeholder:text-slate-600 focus:outline-none focus:border-amber-500/50 focus:bg-white/10 transition-all resize-none leading-relaxed"
                                        ></textarea>
                                        <div className="absolute bottom-3 left-3 text-[10px] text-slate-600">{topic.length} حرف</div>
                                    </div>
                                </div>

                                {/* Generate Button */}
                                <button
                                    onClick={handleGenerate}
                                    disabled={isLoading}
                                    className={`w-full py-4 rounded-xl font-bold text-lg shadow-xl flex items-center justify-center gap-3 transition-all transform active:scale-95 group ${
                                        isLoading 
                                        ? 'bg-slate-800 text-slate-500 cursor-not-allowed' 
                                        : 'bg-gradient-to-r from-amber-400 to-orange-600 text-black hover:shadow-amber-500/20'
                                    }`}
                                >
                                    {isLoading ? (
                                        <><Icons.Loader2 className="animate-spin" /> جاري التحضير...</>
                                    ) : (
                                        <><Icons.Sparkles className="group-hover:animate-pulse" /> توليد المحتوى</>
                                    )}
                                </button>
                                {error && <p className="text-red-400 text-sm text-center">{error}</p>}
                            </div>
                        </section>

                        {/* RIGHT: Output Console */}
                        <aside className={`fixed inset-0 lg:static lg:inset-auto z-40 lg:w-[400px] lg:border-r lg:border-white/5 bg-[#020617] lg:bg-[#050b1d]/30 flex flex-col transition-transform duration-300 ${generatedContent || window.innerWidth >= 1024 ? 'translate-x-0' : 'translate-x-full lg:translate-x-0'}`}>
                            
                            {/* Mobile Close Header */}
                            <div className="lg:hidden p-4 border-b border-white/10 flex items-center justify-between">
                                <h3 className="font-bold text-white">النتيجة</h3>
                                <button onClick={() => setGeneratedContent('')}><Icons.X /></button>
                            </div>

                            {!generatedContent ? (
                                <div className="flex-1 flex flex-col items-center justify-center text-slate-600 p-8 text-center opacity-50">
                                    <div className="w-24 h-24 rounded-full bg-white/5 flex items-center justify-center mb-4 animate-float">
                                        <Icons.Bot size={48} className="text-slate-700" />
                                    </div>
                                    <p className="text-sm">أدخل البيانات واضغط على "توليد"<br/>ليبدأ السحر</p>
                                </div>
                            ) : (
                                <div className="flex-1 flex flex-col h-full overflow-hidden">
                                    {/* Toolbar */}
                                    <div className="p-4 border-b border-white/5 flex justify-between items-center bg-black/20">
                                        <div className="flex bg-white/5 p-1 rounded-lg border border-white/5">
                                            <button onClick={() => setViewMode('text')} className={`p-1.5 rounded px-3 text-xs font-bold transition-all ${viewMode === 'text' ? 'bg-white/10 text-white' : 'text-slate-500'}`}>نص</button>
                                            <button onClick={() => setViewMode('preview')} className={`p-1.5 rounded px-3 text-xs font-bold transition-all ${viewMode === 'preview' ? 'bg-white/10 text-white' : 'text-slate-500'}`}>معاينة</button>
                                        </div>
                                        <div className="flex gap-2">
                                            <button 
                                                onClick={() => {
                                                    const current = history.find(h => h.fullText === generatedContent) || { id: Date.now(), fullText: generatedContent, platform, contentType, topic };
                                                    toggleFavorite(current);
                                                }}
                                                className={`p-2 rounded-lg border border-white/5 ${favorites.some(f => f.fullText === generatedContent) ? 'text-amber-400 bg-amber-400/10' : 'text-slate-500 hover:text-white'}`}
                                            >
                                                <Icons.Star size={18} fill={favorites.some(f => f.fullText === generatedContent) ? "currentColor" : "none"} />
                                            </button>
                                            <button 
                                                onClick={() => { navigator.clipboard.writeText(generatedContent); playSound('success'); }}
                                                className="p-2 rounded-lg bg-indigo-500/10 text-indigo-400 border border-indigo-500/20 hover:bg-indigo-500/20"
                                            >
                                                <Icons.Copy size={18} />
                                            </button>
                                        </div>
                                    </div>

                                    {/* Content Area */}
                                    <div className="flex-1 overflow-y-auto p-6 custom-scroll">
                                        {viewMode === 'text' ? (
                                            <div className="bg-white/5 border border-white/5 rounded-2xl p-6 relative group">
                                                <div className="absolute top-0 left-1/2 -translate-x-1/2 w-full h-1 bg-gradient-to-r from-transparent via-amber-500 to-transparent opacity-50"></div>
                                                <div className="prose prose-invert prose-p:text-slate-300 prose-headings:text-amber-400 max-w-none whitespace-pre-line leading-8 font-medium">
                                                    {generatedContent}
                                                </div>
                                            </div>
                                        ) : (
                                            <PlatformPreview content={generatedContent} platformId={platform} />
                                        )}
                                    </div>
                                </div>
                            )}
                        </aside>
                    </main>

                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 z-50 bg-black/90 backdrop-blur-xl flex items-center justify-center p-4">
                            <div className="w-full max-w-md bg-[#0f172a] border border-white/10 rounded-2xl p-8 shadow-2xl relative">
                                <button onClick={() => apiKey && setShowSettings(false)} className="absolute top-4 right-4 text-slate-500 hover:text-white"><Icons.X /></button>
                                
                                <div className="text-center mb-8">
                                    <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-400 to-orange-600 flex items-center justify-center shadow-lg mx-auto mb-4">
                                        <Icons.Key size={32} className="text-black" />
                                    </div>
                                    <h2 className="text-2xl font-bold text-white mb-2">مفتاح الدخول</h2>
                                    <p className="text-slate-400 text-sm">للبدء، يرجى إدخال مفتاح Google Gemini API الخاص بك.</p>
                                </div>
                                
                                <div className="space-y-4">
                                    <input 
                                        type="password" 
                                        placeholder="AIzaSy..." 
                                        className="w-full p-4 rounded-xl bg-black border border-white/10 text-white focus:border-amber-500 focus:outline-none transition-colors"
                                        onChange={(e) => setApiKey(e.target.value)}
                                        value={apiKey}
                                    />
                                    <button 
                                        onClick={() => { localStorage.setItem('gemini_api_key', apiKey); setShowSettings(false); playSound('success'); }}
                                        className="w-full py-4 rounded-xl bg-white text-black font-bold hover:bg-slate-200 transition-colors"
                                    >
                                        حفظ وبدء السحر
                                    </button>
                                </div>
                                <p className="mt-6 text-center text-[10px] text-slate-600">يتم حفظ المفتاح في متصفحك فقط ولا يتم إرساله لأي خادم آخر.</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SocialWizardWeb />);
    </script>
</body>
</html>
